<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    </head>
    <style>
        .hidden {
            display: none;
        }
        .selected {
            background-color: brown;
            color: #FFF;
        }
        #tbody tr {
            cursor: pointer;
        }
    </style>
    <body>
        <div class="container">
            <nav class="navbar navbar-default">
                <div class="container-fluid">
                    <div class="navbar-header">
                        <button type="button" class="collapsed navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-3" aria-expanded="false">
                            <span class="sr-only">Toggle navigation</span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <a href="#" class="navbar-brand">JsForce</a>
                    </div>
                    <div class="collapse navbar-collapse navbar-right">
                        <p class="navbar-text"></p>
                        <button type="button" class="btn btn-default navbar-btn hidden" id="loginBtn" onclick="javascript:jsforce.browser.login();">
                            Sign in
                        </button>
                        <button type="button" class="btn btn-default navbar-btn hidden" id="logoutBtn" onclick="logout();">Logout</button>
                    </div>
                </div>
            </nav>
           
            <table class="table table-bordered table-hover hidden" id="table-records">
                <thead>
                    <tr>
                        <th>Id</th>
                        <th>Folder Name</th>
                    </tr>
                </thead>
                <tbody id="tbody"></tbody>
            </table>
        </div>
    </body>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <script src="js/jsforce.js"></script>
    <script>
        jsforce.browser.init({
            clientId: "3MVG9pe2TCoA1Pf6rEeJ8R.bAvcmpyP4fspWbIKVgYFT8aBhedO.cgPlYEJPqwWx2XctzyaVzp1thL2RKs8c.",
            redirectUri: "https://platform-app-events.herokuapp.com/oauthcallback.html",
            proxyUrl: "https://node-salesforce-proxy.herokuapp.com/proxy/"
        });

        var conn;
        $(function() {
            if (jsforce.browser.isLoggedIn()) {
                $("#loginBtn").addClass("hidden");
                $('#logoutBtn').removeClass("hidden");
                getUser();
                startQuery();
            } else {
                $('#logoutBtn').addClass("hidden");
                $('#loginBtn').removeClass("hidden");
                getUser();
                startQuery();
            }

            localStorage.removeItem('id');
            localStorage.removeItem('name');
        });

        function startQuery() {
            jsforce.browser.on("connect", function(conn) {
                conn.query("Select Id, Name From Folder__c Order By CreatedDate Desc", function(err, res) {
                    if (err) {
                        return console.error(err);
                    } else if (res.records.length > 0) {
                        for (var i in res.records) {
                            $("#tbody").append(
                                '<tr onclick="tbody(this)">' +
                                    '<td>' + res.records[i].Id + '</td>' + 
                                    '<td>' + res.records[i].Name +'</td>' + 
                                '</tr>'
                            );
                        }

                        getUser();
                        $("#table-records").removeClass("hidden");
                        $("#loginBtn").addClass("hidden");
                        $('#logoutBtn').removeClass("hidden");
                    }
                });
            });
        }

        function getUser() {
            var url = localStorage.getItem("jsforce0_id");
            var jsforceid = /(\w+)$/.exec(url);
            var userQuery = "SELECT Id,Name FROM User WHERE Id='" + jsforceid[0] + "'";
            var conn = jsforce.browser.connection;

            conn.query(userQuery, function(err, res) {
                if (err) { return handleError(err); }
                $(".navbar-text").text("Signed in as " + res.records[0].Name);
            });
        }

        function logout() {
            jsforce.browser.logout();
            location.reload();
        }

        function tbody(e) {
            var first = e.firstElementChild.textContent;
            var last = e.lastElementChild.textContent;

            localStorage.setItem("id", first);
            localStorage.setItem("name", last);
            window.location.href = "folder-edit.html";
        };
    </script>
</html>